<div class="container">
    <% if !@empty %>
        <h1>Risultati ricerca</h1>
        <div class="container main">

        
            <% @data.each do |item| %>
            
<!--             GESTIONE SCALI             -->
                

                <% if item["slice"][0]["segment"].count > 1 %>
                <%     scalo_andata = true %>
                <%     aeroporto_scalo_andata = item["slice"][0]["segment"][0]["leg"][0]["destination"] %>
                <%     aeroporto_destinazione_andata = item["slice"][0]["segment"][1]["leg"][0]["destination"] %>
                <% else %>
                <%     scalo_andata = false %>
                <%     aeroporto_destinazione_andata = item["slice"][0]["segment"][0]["leg"][0]["destination"] %>
                <% end %>
                
                <% if item["slice"][1]["segment"].count > 1 %>
                <%     scalo_ritorno = true %>
                <%     aeroporto_scalo_ritorno = item["slice"][1]["segment"][0]["leg"][0]["destination"] %>
                <%     aeroporto_destinazione_ritorno = item["slice"][1]["segment"][1]["leg"][0]["destination"] %>
                <% else %>
                <%     scalo_ritorno = false %>
                <%     aeroporto_destinazione_ritorno = item["slice"][1]["segment"][0]["leg"][0]["destination"] %>
                <% end %>
                
                
                <div class="row well">
                    <div class="container">
                        <div class="row">
                            <div class="col-sm-2">
                                <h3>Prezzo: </h3>
                                <% price = item["saleTotal"][3..-1].to_f %>
                                <% price2 = (price + (@value * price )).round(2) %>
                                <%= price2.to_s + "â‚¬" %>
                            </div>
                            <div class="col-sm-2">
                                </br></br>
                                <h3>Andata: </h3>
                            </div>
                            <div class="col-sm-2">
                                <h3>Partenza: </h3>
                                <%= item["slice"].first["segment"][0]["leg"][0]["departureTime"] %>
                                <% airport_code = item["slice"].first["segment"][0]["leg"][0]["origin"] %>
                                <%= @airports[airport_code]  %>
                            </div>
                            <div class="col-sm-2">
                                <h3>Arrivo: </h3>
                                <%= item["slice"].first["segment"][0]["leg"][0]["arrivalTime"] %>
                                <% airport_code = aeroporto_destinazione_andata %>
                                <%= @airports[airport_code]  %>
                            </div>
                            <div class="col-sm-4">
                                <h3>Compagnia:</h3>
                                <% code = item["slice"].first["segment"][0]["flight"]["carrier"] %>
                                <%= link_to(@carriers[code], @websites[code], target: "_blank") %>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-sm-2">
                                <% if scalo_andata %>
                                    <h3>Scalo Andata:</h3>
                                    <%= @airports[aeroporto_scalo_andata] %>
                                <% end %>
                                <% if scalo_ritorno %>
                                    <h3> Scalo Ritorno:</h3>
                                    <%= @airports[aeroporto_scalo_ritorno] %>
                                <% end %>
                            </div>
                            <div class="col-sm-2">
                                </br>
                                <h3>Ritorno: </h3>
                            </div>
                            <div class="col-sm-2">
                                </br></br>
                                <%= item["slice"].last["segment"][0]["leg"][0]["departureTime"] %>
                                <% airport_code = item["slice"].last["segment"][0]["leg"][0]["origin"] %>
                                <%= @airports[airport_code]  %>
                            </div>  
                            <div class="col-sm-2">
                                </br></br>
                                <%= item["slice"].last["segment"][0]["leg"][0]["arrivalTime"] %>
                                <% airport_code = aeroporto_destinazione_ritorno %>
                                <%= @airports[airport_code]  %>
                            </div> 
                            <div class="col-sm-4">
                                <h3>Compagnia:</h3>
                                <% code = item["slice"].last["segment"][0]["flight"]["carrier"] %>
                                <%= link_to(@carriers[code], @websites[code], target: "_blank") %>
                            </div>
                        </div>
                    </div>
                    
                    
                </div>
            <% end %>
        

        </div>
    <% else %>
        <div class="jumbotron">
            <h1>Nessun Risultato</h1>      
            <p>Nessun volo disponibile per la combinazione percorso/date selezionata.</p>
        </div>
    <% end %>
</div>