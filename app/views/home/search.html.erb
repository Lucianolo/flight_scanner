<div class="container">
    <% if !@empty %>
        <h1>Risultati ricerca</h1>
        <div class="container main">
            
            
            
            
        
            <% @data.each do |item| %>
            
<!--             GESTIONE SCALI             -->
                

                <% if item["slice"][0]["segment"].count > 1 %>
                <%     scalo_andata = true %>
                <%     aeroporto_scalo_andata = item["slice"][0]["segment"][0]["leg"][0]["destination"] %>
                <%     aeroporto_destinazione_andata = item["slice"][0]["segment"][1]["leg"][0]["destination"] %>
                <% else %>
                <%     scalo_andata = false %>
                <%     aeroporto_destinazione_andata = item["slice"][0]["segment"][0]["leg"][0]["destination"] %>
                <% end %>
                
                <% if item["slice"][1]["segment"].count > 1 %>
                <%     scalo_ritorno = true %>
                <%     aeroporto_scalo_ritorno = item["slice"][1]["segment"][0]["leg"][0]["destination"] %>
                <%     aeroporto_destinazione_ritorno = item["slice"][1]["segment"][1]["leg"][0]["destination"] %>
                <% else %>
                <%     scalo_ritorno = false %>
                <%     aeroporto_destinazione_ritorno = item["slice"][1]["segment"][0]["leg"][0]["destination"] %>
                <% end %>
                
                
                
                
                <div class="row well items">
                    <div class="col-md-8">
                      <section class="row">
                        <div class="col-md-4">
                            <h3>
                                <% code = item["slice"].first["segment"][0]["flight"]["carrier"] %>
                                <%= link_to(@carriers[code], @websites[code], target: "_blank") %>
                            </h3>
                        </div>
                        <div class="col-md-3">
                          <div class="partenza">
                            <span class="time">
                                <h3>
                                    <% departureTime = (item["slice"].first["segment"][0]["leg"][0]["departureTime"]).split("T").last %>
                                    <%= departureTime %>
                                </h3>
                            </span>
                            <span class="airport">
                              <h3>
                                <% airport_code = item["slice"].first["segment"][0]["leg"][0]["origin"] %>
                                <%= @airports[airport_code]  %>
                              </h3>
                            </span>
                          </div>
                        </div>
                        <div class="col-md-2 stops" style="padding-top:0.5em;">
                          <span class="duration"><%= item["slice"].first["duration"] %> min</span>
                          <ul class="stop-line">
                            <li class="stop-line"></li>
                          </ul>
                          <% if scalo_andata %>
                              <span class="scali">1 scalo </span>
                              <div class="luogo_scalo"><%= @airports[aeroporto_scalo_andata] %></div>
                          <% else %>
                              <div class="no_scali">Diretto</div>
                          <% end  %>    
                        </div>
                        <div class="col-md-3">
                          <div class="arrivo">
                            <span class="time">
                                <h3>
                                    <% arrivalTime = (item["slice"].first["segment"][0]["leg"][0]["arrivalTime"]).split("T").last %>
                                    <%= arrivalTime %>
                                </h3>
                            </span>
                            <span class="airport">
                              <h3>
                                <% airport_code = aeroporto_destinazione_andata %>
                                <%= @airports[airport_code]  %>
                              </h3>
                            </span>
                          </div>
                        </div>
                      </section>
                      <hr/>
                      <section class="row">
                        <div class="col-md-4">
                          <h3>
                            <% code = item["slice"].last["segment"][0]["flight"]["carrier"] %>
                            <%= link_to(@carriers[code], @websites[code], target: "_blank") %>
                          </h3>
                        </div>
                        <div class="col-md-3">
                          <div class="partenza">
                            <span class="time">
                              <h3>
                                <% departureTime = (item["slice"].last["segment"][0]["leg"][0]["departureTime"]).split("T").last %>
                                <%= departureTime %>
                              </h3>
                            </span>
                            <span class="airport">
                              <h3>
                                <% airport_code = item["slice"].last["segment"][0]["leg"][0]["origin"] %>
                                <%= @airports[airport_code]  %>
                              </h3>
                            </span>
                          </div>
                        </div>
                        <div class="col-md-2 stops" style="padding-top:0.5em;">
                          <span class="duration"><%= item["slice"].first["duration"] %> min</span>
                          <ul class="stop-line">
                            <li class="stop-line"></li>
                          </ul>
                          <% if scalo_ritorno %>
                              <span class="scali">1 scalo </span>
                              <div class="luogo_scalo"><%= @airports[aeroporto_scalo_ritorno] %></div>
                          <% else %>
                              <div class="no_scali">Diretto</div>
                          <% end  %>    
                        </div>
                        <div class="col-md-3">
                          <div class="arrivo">
                            <span class="time">
                              <h3>
                                <% arrivalTime = (item["slice"].last["segment"][0]["leg"][0]["arrivalTime"]).split("T").last %>
                                <%= arrivalTime %>
                              </h3>
                            </span>
                            <span class="airport">
                              <h3>
                                <% airport_code = aeroporto_destinazione_ritorno %>
                                <%= @airports[airport_code]  %>
                              </h3>
                            </span>
                          </div>
                        </div>
                      </section>
                    </div>
                    <div class="col-md-4">
                      <div class="price">
                        <h1>
                            <% price = item["saleTotal"][3..-1].to_f %>
                            <% price2 = (price + (@value * price )).round(2) %>
                            <%= price2.to_s + "â‚¬" %>
                        </h1>
                      </div>
                    </div>
                  </div>
                  
                  
             

            <% end %>
        

        </div>
    <% else %>
        <div class="jumbotron">
            <h1>Nessun Risultato</h1>      
            <p>Nessun volo disponibile per la combinazione percorso/date selezionata.</p>
        </div>
    <% end %>
</div>